/*! Crocodoc Viewer - v0.7.0 | (c) 2014 Box */
!function(a){"use strict";a.Crocodoc=function(a){return"object"!=typeof exports?a(jQuery):void(module.exports=a)}(function(b){if("undefined"==typeof b)throw new Error("jQuery is required");var c=function(){function a(c,d,e){var f;for(e=e||c,f=0;f<d.length;++f){if(c===d[f])throw new Error("Circular dependency detected: "+e+"->"+d[f]);b[d[f]]&&a(c,b[d[f]].mixins,e+"->"+d[f])}}var b={},d={};return{ZOOM_FIT_WIDTH:"fitwidth",ZOOM_FIT_HEIGHT:"fitheight",ZOOM_AUTO:"auto",ZOOM_IN:"in",ZOOM_OUT:"out",SCROLL_PREVIOUS:"previous",SCROLL_NEXT:"next",LAYOUT_VERTICAL:"vertical",LAYOUT_VERTICAL_SINGLE_COLUMN:"vertical-single-column",LAYOUT_HORIZONTAL:"horizontal",LAYOUT_PRESENTATION:"presentation",LAYOUT_PRESENTATION_TWO_PAGE:"presentation-two-page",PAGE_STATUS_CONVERTING:"converting",PAGE_STATUS_NOT_LOADED:"not loaded",PAGE_STATUS_LOADING:"loading",PAGE_STATUS_LOADED:"loaded",PAGE_STATUS_ERROR:"error",ASSET_REQUEST_RETRIES:1,components:b,utilities:d,createViewer:function(a,b){return new c.Viewer(a,b)},getViewer:function(a){return c.Viewer.get(a)},addComponent:function(c,d,e){d instanceof Function&&(e=d,d=[]),a(c,d),b[c]={mixins:d,creator:e}},createComponent:function(a,c){var d=b[a];if(d){for(var e=[],f=0;f<d.mixins.length;++f)e.push(this.createComponent(d.mixins[f],c));return e.unshift(c),d.creator.apply(d.creator,e)}return null},addPlugin:function(a,b){this.addComponent("plugin-"+a,b)},addDataProvider:function(a,b){this.addComponent("data-provider-"+a,b)},addUtility:function(a,b){d[a]={creator:b,instance:null}},getUtility:function(a){var b=d[a];return b?(b.instance||(b.instance=b.creator(this)),b.instance):null}}}();return function(){c.Scope=function(a){function d(a,b){var c,d,e,h;for(c=0,d=g.length;d>c;++c)e=g[c],e&&(h=e.messages||[],-1!==f.inArray(a,h)&&"function"==typeof e.onmessage&&e.onmessage.call(e,a,b))}function e(){for(var a;h.length;)a=h.shift(),d(a.name,a.data);h=null}var f=c.getUtility("common"),g=[],h=[],i={},j=!1;a.dataProviders=a.dataProviders||{},this.createComponent=function(a){var b=c.createComponent(a,this);return b&&(b.componentName=a,g.push(b)),b},this.destroyComponent=function(a){var b,c;for(b=0,c=g.length;c>b;++b)if(a===g[b]){"function"==typeof a.destroy&&a.destroy(),g.splice(b,1);break}},this.destroy=function(){var a,b,c;for(a=0,b=g.length;b>a;++a)c=g[a],"function"==typeof c.destroy&&c.destroy();g=[],i={}},this.broadcast=function(a,b){j?d(a,b):h.push({name:a,data:b})},this.getUtility=function(a){return c.getUtility(a)},this.getConfig=function(){return a},this.ready=function(){j||(j=!0,e())},this.get=function(c,d){var e=a.dataProviders[c]||c,f=this.getDataProvider(e);return f?f.get(c,d):b.Deferred().reject("data-provider not found").promise()},this.getDataProvider=function(a){var b;return i[a]?b=i[a]:(b=this.createComponent("data-provider-"+a),i[a]=b),b}}}(),function(){function a(a,b){var c=!1;return{type:a,data:b,preventDefault:function(){c=!0},isDefaultPrevented:function(){return c}}}c.EventTarget=function(){this._handlers={}},c.EventTarget.prototype={constructor:c.EventTarget,on:function(a,b){"undefined"==typeof this._handlers[a]&&(this._handlers[a]=[]),this._handlers[a].push(b)},fire:function(b,c){var d,e,f,g=a(b,c);if(d=this._handlers[g.type],d instanceof Array)for(d=d.concat(),e=0,f=d.length;f>e;e++)d[e]&&d[e].call(this,g);if(d=this._handlers.all,d instanceof Array)for(d=d.concat(),e=0,f=d.length;f>e;e++)d[e]&&d[e].call(this,g);return g},off:function(a,b){var c,d,e=this._handlers[a];if(e instanceof Array){if(!b)return void(e.length=0);for(c=0,d=e.length;d>c;c++)if(e[c]===b||e[c].handler===b){e.splice(c,1);break}}},one:function(a,b){var c=this,d=function(e){c.off(a,d),b.call(c,e)};d.handler=b,this.on(a,d)}}}(),function(){var a="crocodoc-text-disabled",d="crocodoc-links-disabled",e=0,f={};c.Viewer=function(g,h){function i(){o.init()}c.EventTarget.call(this);var j,k=c.getUtility("common"),l=b(g),m=k.extend(!0,{},c.Viewer.defaults,h),n=new c.Scope(m),o=n.createComponent("viewer-base");if(0===l.length)throw new Error("Invalid container element");this.id=m.id=++e,m.api=this,m.$el=l,f[this.id]=this,this.destroy=function(){delete f[m.id],n.broadcast("destroy"),n.destroy()},this.load=function(){o.loadAssets()},this.setLayout=function(a){j=null,j=o.setLayout(a)},this.zoom=function(a){var b=parseFloat(a);j&&(b&&(a=b/(m.pageScale||1)),j.setZoom(a))},this.scrollTo=function(a){j&&j.scrollTo(a)},this.scrollBy=function(a,b){j&&j.scrollBy(a,b)},this.focus=function(){j&&j.focus()},this.enableTextSelection=function(){m.enableTextSelection||(l.removeClass(a),m.enableTextSelection=!0,n.broadcast("textenabledchange",{enabled:!0}))},this.disableTextSelection=function(){m.enableTextSelection&&(l.addClass(a),m.enableTextSelection=!1,n.broadcast("textenabledchange",{enabled:!1}))},this.enableLinks=function(){m.enableLinks||(l.removeClass(d),m.enableLinks=!0)},this.disableLinks=function(){m.enableLinks&&(l.addClass(d),m.enableLinks=!1)},this.updateLayout=function(){j&&(j.updatePageStates(!0),j.setZoom())},i()},c.Viewer.prototype=new c.EventTarget,c.Viewer.prototype.constructor=c.Viewer,c.Viewer.get=function(a){return f[a]},c.Viewer.defaults={url:null,layout:c.LAYOUT_VERTICAL,zoom:c.ZOOM_AUTO,page:1,enableTextSelection:!0,enableLinks:!0,enableDragging:!1,queryParams:null,plugins:{},useWindowAsViewport:!1,conversionIsComplete:!0,template:{svg:"page-{{page}}.svg",img:"page-{{page}}.png",html:"text-{{page}}.html",css:"stylesheet.css",json:"info.json"},dataProviders:{metadata:"metadata",stylesheet:"stylesheet","page-svg":"page-svg","page-text":"page-text","page-img":"page-img"},pageStart:null,pageEnd:null,zoomLevels:[.25,.5,.75,1,1.25,1.5,2,3]}}(),c.addDataProvider("metadata",function(a){function b(a){return e.parseJSON(a)}var d=a.getUtility("ajax"),e=a.getUtility("common"),f=a.getConfig();return{get:function(){var a=this.getURL(),e=d.fetch(a,c.ASSET_REQUEST_RETRIES);return e.then(b).promise({abort:e.abort})},getURL:function(){var a=f.template.json;return f.url+a+f.queryString}}}),c.addDataProvider("page-img",function(a){var d=a.getUtility("common"),e=a.getConfig();return{get:function(a,d){function e(){g.setAttribute("src",j)}function f(){g.removeAttribute("src")}var g=this.getImage(),h=c.ASSET_REQUEST_RETRIES,i=!1,j=this.getURL(d),k=b.Deferred();return g.onload=function(){i=!0,k.resolve(g)},g.onerror=function(){h>0?(h--,f(),e()):(g=null,i=!1,k.reject({error:"image failed to load",resource:j}))},e(),k.promise({abort:function(){i||(f(),k.reject())}})},getURL:function(a){var b=d.template(e.template.img,{page:a});return e.url+b+e.queryString},getImage:function(){return new Image}}}),c.addDataProvider("page-svg",function(a){function b(a,b){var c="<style>"+b+"</style>";return h.firefox&&!i.isSubpxSupported()&&(c+="<style>text { text-rendering: geometricPrecision; }</style>"),a=a.replace(/<xhtml:link[^>]*>/,c)}function d(c){if(!k){var d,g=j.queryString.replace("&","&#38;");return d=f.countInStr(c,'xlink:href="data:image'),d>e&&(c=c.replace(/<image[\s\w-_="]*xlink:href="data:image\/[^"]{0,5120}"[^>]*>/gi,"")),c=c.replace(/href="([^"#:]*)"/g,function(a,b){return'href="'+j.url+b+g+'"'}),a.get("stylesheet").then(function(a){return b(c,a)})}}var e=1e3,f=a.getUtility("common"),g=a.getUtility("ajax"),h=a.getUtility("browser"),i=a.getUtility("subpx"),j=a.getConfig(),k=!1,l={};return{get:function(a,b){var e,f=this.getURL(b);return l[b]?l[b]:(e=g.fetch(f,c.ASSET_REQUEST_RETRIES),l[b]=e.then(d).promise({abort:function(){e.abort(),l&&delete l[b]}}),l[b])},getURL:function(a){var b=f.template(j.template.svg,{page:a});return j.url+b+j.queryString},destroy:function(){k=!0,f=g=i=h=j=l=null}}}),c.addDataProvider("page-text",function(a){function b(a){if(!h){var b=e.countInStr(a,"<div");return b>d?"":a=a.replace(/<link rel="stylesheet".*/,"")}}var d=256,e=a.getUtility("common"),f=a.getUtility("ajax"),g=a.getConfig(),h=!1,i={};return{get:function(a,d){var e,g=this.getURL(d);return i[d]?i[d]:(e=f.fetch(g,c.ASSET_REQUEST_RETRIES),i[d]=e.then(b).promise({abort:function(){e.abort(),i&&delete i[d]}}),i[d])},getURL:function(a){var b=e.template(g.template.html,{page:a});return g.url+b+g.queryString},destroy:function(){h=!0,e=f=g=i=null}}}),c.addDataProvider("stylesheet",function(a){function b(a){return f.ie&&(a=a.replace(/font-family:[\s\"\']*([\w-]+)\b/g,"$0-"+g.id)),a}var d,e=a.getUtility("ajax"),f=a.getUtility("browser"),g=a.getConfig();return{get:function(){if(d)return d;var a=e.fetch(this.getURL(),c.ASSET_REQUEST_RETRIES);return d=a.then(b).promise({abort:function(){a.abort(),d=null}})},getURL:function(){var a=g.template.css;return g.url+a+g.queryString},destroy:function(){e=f=g=null,d=null}}}),c.addUtility("ajax",function(a){function c(a){var b,c,d;try{b=a.status,c=a.statusText,d=a.responseText}catch(e){b=0,c="",d=null}return{status:b,statusText:c,responseText:d,rawRequest:a}}function d(a,b){return"file:"===k.parse(a).protocol&&0===b.status&&""!==b.responseText}function e(a){return a=i.extend(!0,{},a||{}),a.method=a.method||"GET",a.headers=a.headers||[],a.data=a.data||"","string"!=typeof a.data&&(a.data=b.param(a.data),"GET"!==a.method&&(a.data=a.data,a.headers.push(["Content-Type","application/x-www-form-urlencoded"]))),a}function f(a,b){var c;for(c=0;c<b.length;++c)a.setRequestHeader(b[c][0],b[c][1])}function g(a,b,c,e,g,h){var i=j.getXHR();return i.open(b,a,!0),i.onreadystatechange=function(){var b;if(4===i.readyState){i.onreadystatechange=function(){};try{b=i.status}catch(c){return void h(i)}200===b||d(a,i)?g(i):h(i)}},f(i,e),i.send(c),i}function h(a,b,c,d,e){var f=j.getXDR();try{f.open(b,a),f.onload=function(){d(f)},f.onerror=function(){e(f)},f.ontimeout=function(){e(f)},f.onprogress=function(){},f.send(c)}catch(g){return e({status:0,statusText:g.message})}return f}var i=a.getUtility("common"),j=a.getUtility("support"),k=a.getUtility("url");return{request:function(a,b){function d(a){return i.isFn(l.success)&&l.success.call(c(a)),a}function f(a){return i.isFn(l.fail)&&l.fail.call(c(a)),a}var l=e(b),m=l.method,n=l.data,o=l.headers;return"GET"===m&&n&&(a=k.appendQueryParams(a,n),n=""),j.isXHRSupported()?k.isCrossDomain(a)&&!j.isCORSSupported()?h(a,m,n,d,f):g(a,m,n,o,d,f):l.fail({status:0,statusText:"AJAX not supported"})},fetch:function(a,c){function d(a){c>0?(c--,f=e()):i.reject(a)}function e(){return h.request(a,{success:function(){g||(this.responseText?i.resolve(this.responseText):d({error:"empty response",status:this.status,resource:a}))},fail:function(){g||d({error:this.statusText,status:this.status,resource:a})}})}var f,g=!1,h=this,i=b.Deferred();return f=e(),i.promise({abort:function(){g=!0,f.abort()}})},sendJSON:function(a,c){function d(){return f.request(a,{method:"POST",data:i.stringifyJSON(c),headers:[["Content-Type","application/json"]],success:function(){if(this.responseText){var a;try{"application/json"===this.rawRequest.getResponseHeader("content-type")?(a=i.parseJSON(this.responseText),g.resolve(a)):g.reject("response not json")}catch(b){g.reject("invalid json")}}else g.reject("empty response")},fail:function(){g.reject(this.statusText)}})}var e,f=this,g=b.Deferred();return e=d(),g.promise()}}}),c.addUtility("browser",function(){var a,b=navigator.userAgent,c={},d=/ip(hone|od|ad)/i.test(b),e=/android/i.test(b),f=/blackberry/i.test(b),g=/webos/i.test(b),h=/silk|kindle/i.test(b),i=/MSIE|Trident/i.test(b);return i&&(c.ie=!0,a=/MSIE/i.test(b)?/MSIE\s+(\d+\.\d+)/i.exec(b):/Trident.*rv[ :](\d+\.\d+)/.exec(b),c.version=a&&parseFloat(a[1]),c.ielt9=c.version<9,c.ielt10=c.version<10,c.ielt11=c.version<11),d&&(c.ios=!0,a=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),c.version=a&&parseFloat(a[1]+"."+a[2])),c.mobile=/mobile/i.test(b)||d||e||f||g||h,c.firefox=/firefox/i.test(b),/safari/i.test(b)&&(c.chrome=/chrome/i.test(b),c.safari=!c.chrome),c.safari&&(a=navigator.appVersion.match(/Version\/(\d+(\.\d+)?)/),c.version=a&&parseFloat(a[1])),c}),c.addUtility("common",function(){var c=1.33333,d={};return d.extend=b.extend,d.each=b.each,d.map=b.map,d.param=b.param,d.parseJSON=b.parseJSON,d.stringifyJSON="undefined"!=typeof a.JSON?a.JSON.stringify:function(){throw new Error("JSON.stringify not supported")},b.extend(d,{bisectLeft:function(a,b,c){for(var d,e,f=0,g=a.length;g>f;)e=Math.floor((f+g)/2),d=c?a[e][c]:a[e],b>d?f=e+1:g=e;return f},bisectRight:function(a,b,c){for(var d,e,f=0,g=a.length;g>f;)e=Math.floor((f+g)/2),d=c?a[e][c]:a[e],d>b?g=e:f=e+1;return f},clamp:function(a,b,c){return b>a?b:a>c?c:a},sign:function(a){var b=parseInt(a,10);return b?0>b?-1:1:b},isFn:function(a){return"function"==typeof a},inArray:function(a,c){return d.isFn(c.indexOf)?c.indexOf(a):b.inArray(a,c)},constrainRange:function(a,b,c){var e=b-a;return a=d.clamp(a,0,c),b=d.clamp(a+e,0,c),e>b-a&&(a=d.clamp(b-e,0,c)),{min:a,max:b}},now:function(){return(new Date).getTime()},throttle:function(a,b){function c(){i=d.now(),g=null,h=b.apply(e,f)}var e,f,g,h,i=0;return function(){var j=d.now(),k=a-(j-i);return e=this,f=arguments,0>=k?(clearTimeout(g),g=null,i=j,h=b.apply(e,f)):g||(g=setTimeout(c,k)),h}},debounce:function(a,b){function c(){var j=d.now()-h;a>j?g=setTimeout(c,a-j):(g=null,i=b.apply(e,f),e=f=null)}var e,f,g,h,i;return function(){return e=this,f=arguments,h=d.now(),g||(g=setTimeout(c,a)),i}},insertCSS:function(a){var b=document.createElement("style"),c=document.createTextNode(a);try{b.setAttribute("type","text/css"),b.appendChild(c)}catch(d){}return document.getElementsByTagName("head")[0].appendChild(b),b},appendCSSRule:function(a,b,c){var d;return a.insertRule?a.insertRule(b+"{"+c+"}",a.cssRules.length):(d=a.addRule(b,c,a.rules.length),0>d&&(d=a.rules.length-1),d)},deleteCSSRule:function(a,b){a.deleteRule?a.deleteRule(b):a.removeRule(b)},getSelectedNode:function(){var b,c,d;return a.getSelection?(c=a.getSelection(),c.rangeCount&&(d=c.getRangeAt(0),d.collapsed||(b=c.anchorNode.parentNode))):document.selection&&(b=document.selection.createRange().parentElement()),b},getComputedStyle:function(b){return"getComputedStyle"in a?a.getComputedStyle(b):b.currentStyle},calculatePtSize:function(){var a,b,e=1e4,f=document.createElement("div");return f.style.display="block",f.style.position="absolute",f.style.width=e+"pt",document.body.appendChild(f),a=d.getComputedStyle(f),b=a&&a.width?parseFloat(a.width)/e:c,document.body.removeChild(f),b},countInStr:function(a,b){for(var c,d=0;c=a.indexOf(b,c)+1;)d++;return d},template:function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a=a.replace(new RegExp("\\{\\{"+c+"\\}\\}","g"),b[c]));return a}})}),c.addUtility("subpx",function(c){function d(){if(!b.support.leadingWhitespace)return!1;var c=b(g.template(f,{size:12.5})).appendTo(document.documentElement).get(0),d=b(c).css("font-size"),e=b(c).width();b(c).remove(),c=b(g.template(f,{size:12.6})).appendTo(document.documentElement).get(0);var h=b(c).css("font-size"),i=b(c).width();if(b(c).remove(),!("ontouchstart"in a)){if(d===h)return!1;if(e===i)return!1}return!0}var e="crocodoc-subpx-fix",f='<span style="font:{{size}}px serif; color:transparent; white-space:nowrap;">'+new Array(100).join("A")+"</span>",g=c.getUtility("common"),h=d();return{fix:function(a){if(!h&&void 0!==document.body.style.zoom){var c=b("<div>").addClass(e);b(a).children().wrapAll(c)}return a},isSubpxSupported:function(){return h}}}),c.addUtility("support",function(){function b(a){var b,d,e,g=document.createElement("div");if(a in g.style)return a;if(b=a.charAt(0).toUpperCase()+a.substr(1),a in g.style)return a;for(d=0;d<f.length;++d)if(e=f[d]+b,e in g.style)return 0===e.indexOf("ms")&&(e="-"+e),c(e);return!1}function c(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}var d,e,f=["Moz","Webkit","O","ms"],g=null,h=null;return function(){var b=0,c=["ms","moz","webkit","o"];d=a.requestAnimationFrame,e=a.cancelAnimationFrame;for(var f=0;f<c.length&&!d;++f)d=a[c[f]+"RequestAnimationFrame"],e=a[c[f]+"CancelAnimationFrame"]||a[c[f]+"CancelRequestAnimationFrame"];d||(d=function(c){var d=(new Date).getTime(),e=Math.max(0,16-(d-b)),f=a.setTimeout(function(){c(d+e)},e);return b=d+e,f},e=function(a){clearTimeout(a)})}(),{svg:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),csstransform:b("transform"),csstransition:b("transition"),csszoom:b("zoom"),isXHRSupported:function(){return null===g&&(g=!!this.getXHR()),g},isCORSSupported:function(){return null===h&&(h=this.isXHRSupported()&&"withCredentials"in this.getXHR()),h},isXDRSupported:function(){return"undefined"!=typeof a.XDomainRequest},getXHR:function(){if(a.XMLHttpRequest)return new a.XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(b){return null}},getXDR:function(){return this.isXDRSupported()?new a.XDomainRequest:null},requestAnimationFrame:function(){return d.apply(a,arguments)},cancelAnimationFrame:function(){e.apply(a,arguments)}}}),c.addUtility("url",function(b){var c,d=b.getUtility("browser");return{getCurrentURL:function(){return a.location.href},makeAbsolute:function(a){return this.parse(a).href},isCrossDomain:function(a){var b=this.parse(a);return c||(c=this.parse(this.getCurrentURL())),b.hostname?b.protocol!==c.protocol||b.hostname!==c.hostname||b.port!==c.port:!1},appendQueryParams:function(a,b){return a.indexOf("?")>-1?a+"&"+b:a+"?"+b},parse:function(a){var b,c=document.createElement("a");return c.href=a,d.ie&&a!==c.href&&(a=c.href,c.href=a),b=c.pathname,/^\//.test(b)||(b="/"+b),{href:c.href,protocol:c.protocol,host:c.host,hostname:c.hostname,port:c.port,pathname:b,hash:c.hash,search:c.search}}}}),c.addComponent("dragger",function(c){function d(a){g.scrollTop(h.top-(a.clientY-i.y)),g.scrollLeft(h.left-(a.clientX-i.x)),a.preventDefault()}function e(a){c.broadcast("dragend"),j.off("mousemove",d),j.off("mouseup",e),a.preventDefault()}function f(a){c.broadcast("dragstart"),h={top:g.scrollTop(),left:g.scrollLeft()},i={x:a.clientX,y:a.clientY},j.on("mousemove",d),j.on("mouseup",e),a.preventDefault()}var g,h,i,j=b(a);return{init:function(a){g=b(a),g.on("mousedown",f)},destroy:function(){g.off("mousedown",f),g.off("mousemove",d),j.off("mouseup",e)}}}),c.addComponent("layout-base",function(b){function d(a,b){var c,d,e,f,g=a.state,h="."+a.config.namespace+" ."+j,i=a.config.stylesheet,k=g.pages,l=b*a.config.pageScale,m=100/l;for(f=s.csstransform?s.csstransform+":scale("+l+");width:"+m+"%;height:"+m+"%;":s.csszoom?"zoom:"+l:"",g.previousStyleIndex&&r.deleteCSSRule(i,g.previousStyleIndex),g.previousStyleIndex=r.appendCSSRule(i,h,f),c=0,d=k.length;d>c;++c)e=k[c],a.$pages.eq(c).css({width:e.actualWidth*b,height:e.actualHeight*b,paddingTop:e.paddingTop*b,paddingRight:e.paddingRight*b,paddingBottom:e.paddingBottom*b,paddingLeft:e.paddingLeft*b})}function e(a,b){if(!b||0===b.length)return 1/0;var c=r.map(b,function(b){return a[b].y1});return Math.max.apply(Math,c)}var f="crocodoc-layout-",g="crocodoc-current-page",h="crocodoc-page-",i=h+"visible",j=h+"autoscale",k="padding-",l=k+"top",m=k+"right",n=k+"left",o=k+"bottom",p=.95,q=.99,r=b.getUtility("common"),s=b.getUtility("support");return{messages:["resize","scroll","scrollend"],onmessage:function(a,b){switch(a){case"resize":this.handleResize(b);break;case"scroll":this.handleScroll(b);break;case"scrollend":this.handleScrollEnd(b)}},init:function(){var a=b.getConfig();this.config=a,this.$el=a.$el,this.$doc=a.$doc,this.$viewport=a.$viewport,this.$pages=a.$pages,this.numPages=a.numPages,this.layoutClass=f+a.layout,this.$el.addClass(this.layoutClass),this.initState(),this.updatePageStates(),this.updateZoomLevels()},initState:function(){var b=this.$viewport[0],c=b;b===a&&(c=document.documentElement),this.state={pages:[],widestPage:{index:0,actualWidth:0},tallestPage:{index:0,actualHeight:0},sumWidths:0,sumHeights:0,rows:[],scrollTop:b.scrollTop,scrollLeft:b.scrollLeft,viewportDimensions:{clientWidth:c.clientWidth,clientHeight:c.clientHeight,offsetWidth:c.offsetWidth,offsetHeight:c.offsetHeight},zoomState:{zoom:1,prevZoom:0,zoomMode:null},currentPage:null,visiblePages:[],fullyVisiblePages:[],initialWidth:0,initialHeight:0},this.zoomLevels=[]},destroy:function(){this.$doc.removeAttr("style"),this.$pages.css("padding",""),this.$el.removeClass(this.layoutClass)},setZoom:function(a){var d,e,f=this.state,g=this.parseZoomValue(a),h=f.zoomState,i=h.zoom;d=this.calculateZoomMode(a,g),g=r.clamp(g,f.minZoom,f.maxZoom),b.broadcast("beforezoom",r.extend({page:f.currentPage,visiblePages:r.extend([],f.visiblePages),fullyVisiblePages:r.extend([],f.fullyVisiblePages)},h)),h.prevZoom=i,h.zoom=g,h.zoomMode=d,this.applyZoom(g),h.canZoomIn=this.calculateNextZoomLevel(c.ZOOM_IN)!==!1,h.canZoomOut=this.calculateNextZoomLevel(c.ZOOM_OUT)!==!1,this.updatePageStates(),this.updateLayout(),e=a===c.ZOOM_AUTO||a===c.ZOOM_FIT_WIDTH||a===c.ZOOM_FIT_HEIGHT,this.updateScrollPosition(e),this.updatePageStates(),this.updateVisiblePages(!0),b.broadcast("zoom",r.extend({page:f.currentPage,visiblePages:r.extend([],f.visiblePages),fullyVisiblePages:r.extend([],f.fullyVisiblePages),isDraggable:this.isDraggable()},h))},isDraggable:function(){var a=this.state;return a.viewportDimensions.clientHeight<a.totalHeight||a.viewportDimensions.clientWidth<a.totalWidth},parseZoomValue:function(a){var b=parseFloat(a),d=this.state,e=d.zoomState,f=e.zoom,g=f;if(b)g=b;else switch(a){case c.ZOOM_FIT_WIDTH:case c.ZOOM_FIT_HEIGHT:case c.ZOOM_AUTO:g=this.calculateZoomValue(a);break;case c.ZOOM_IN:case c.ZOOM_OUT:g=this.calculateNextZoomLevel(a)||f;break;default:g=f?e.zoomMode?this.calculateZoomValue(e.zoomMode):f:this.calculateZoomValue(this.config.zoom||c.ZOOM_AUTO)}return g},calculateZoomMode:function(a,b){switch(b){case this.calculateZoomValue(c.ZOOM_AUTO):return"string"!=typeof a||a!==c.ZOOM_FIT_WIDTH&&a!==c.ZOOM_FIT_HEIGHT?c.ZOOM_AUTO:a;case this.calculateZoomValue(c.ZOOM_FIT_WIDTH):return c.ZOOM_FIT_WIDTH;case this.calculateZoomValue(c.ZOOM_FIT_HEIGHT):return c.ZOOM_FIT_HEIGHT;default:return null}},updateZoomLevels:function(){function a(a){var b=d/a;return a===d?!1:p>b?!0:r.inArray(a,i)>-1&&q>b?!0:!1}var b,d,e=this.config.zoomLevels.slice()||[1],f=this.calculateZoomValue(c.ZOOM_AUTO),g=this.calculateZoomValue(c.ZOOM_FIT_WIDTH),h=this.calculateZoomValue(c.ZOOM_FIT_HEIGHT),i=[g,h];for(this.state.minZoom=this.config.minZoom||e[0],this.state.maxZoom=this.config.maxZoom||e[e.length-1],f!==g&&f!==h&&i.push(f),e=e.concat(i),e.sort(function(a,b){return a-b}),this.zoomLevels=[],d=0,b=0;b<e.length;++b)a(e[b])&&(d=e[b],this.zoomLevels.push(d))},calculateNextZoomLevel:function(a){var b,d=!1,e=this.state.zoomState.zoom,f=this.zoomLevels;if(a===c.ZOOM_IN){for(b=0;b<f.length;++b)if(f[b]>e){d=f[b];break}}else if(a===c.ZOOM_OUT)for(b=f.length-1;b>=0;--b)if(f[b]<e){d=f[b];break}return d},calculateZoomValue:function(a){var b=this.state,d=parseFloat(a);return d?d:a===c.ZOOM_FIT_WIDTH?b.viewportDimensions.clientWidth/b.widestPage.totalActualWidth:a===c.ZOOM_FIT_HEIGHT?b.viewportDimensions.clientHeight/b.tallestPage.totalActualHeight:a===c.ZOOM_AUTO?this.calculateZoomAutoValue():b.zoomState.zoom},applyZoom:function(a){d(this,a)},scrollTo:function(a){var b=this.state,d=parseInt(a,10);if("string"==typeof a){if(a===c.SCROLL_PREVIOUS&&b.currentPage>1)d=this.calculatePreviousPage();else if(a===c.SCROLL_NEXT&&b.currentPage<this.numPages)d=this.calculateNextPage();else if(!d)return}else if(!d&&0!==d)return;d=r.clamp(d,1,this.numPages),this.scrollToPage(d)},scrollBy:function(a,b){a=parseInt(a,10)||0,b=parseInt(b,10)||0,this.scrollToOffset(a+this.state.scrollLeft,b+this.state.scrollTop)},scrollToPage:function(a){var b=this.calculateScrollPositionForPage(a);this.scrollToOffset(b.left,b.top)},calculateCurrentPage:function(){return this.state.currentPage},calculateScrollPositionForPage:function(a){var b=r.clamp(a-1,0,this.numPages-1),c=this.state.pages[b];return{top:c.y0,left:c.x0}},calculateVisibleRange:function(){var a=this.state,b=a.scrollTop,c=b+a.viewportDimensions.clientHeight,d=a.scrollLeft,e=d+a.viewportDimensions.clientWidth,f=r.bisectLeft(a.pages,b,"y1"),g=r.bisectRight(a.pages,c,"y0")-1,h=r.bisectLeft(a.pages,d,"x1"),i=r.bisectRight(a.pages,e,"x0")-1,j=Math.max(h,f),k=Math.min(i,g);return r.constrainRange(j,k,this.numPages-1)},calculateFullyVisibleRange:function(){var a=this.state,b=a.scrollTop,c=b+a.viewportDimensions.clientHeight,d=a.scrollLeft,e=d+a.viewportDimensions.clientWidth,f=r.bisectLeft(a.pages,b,"y0"),g=r.bisectRight(a.pages,c,"y1")-1,h=r.bisectLeft(a.pages,d,"x0"),i=r.bisectRight(a.pages,e,"x1")-1,j=Math.max(h,f),k=Math.min(i,g);return r.constrainRange(j,k,this.numPages-1)},scrollToOffset:function(a,b){this.$viewport.scrollLeft(a),this.$viewport.scrollTop(b)},setCurrentPage:function(a){var c=this.state;c.currentPage!==a?(c.currentPage=a,this.updateVisiblePages(),b.broadcast("pagefocus",{page:c.currentPage,numPages:this.numPages,visiblePages:r.extend([],c.visiblePages),fullyVisiblePages:r.extend([],c.fullyVisiblePages)})):this.updateVisiblePages()},updateVisiblePages:function(a){var b,c,d,e=this.state,f=this.calculateVisibleRange(),g=this.calculateFullyVisibleRange();for(e.visiblePages.length=0,e.fullyVisiblePages.length=0,b=0,c=this.$pages.length;c>b;++b)d=this.$pages.eq(b),b<f.min||b>f.max?a&&d.hasClass(i)&&d.removeClass(i):(a&&!d.hasClass(i)&&d.addClass(i),e.visiblePages.push(b+1)),b>=g.min&&b<=g.max&&e.fullyVisiblePages.push(b+1)},updatePageStates:function(a){var b,c,d,f,g,h=this.state,i=h.pages,j=h.rows,k=this.$viewport.scrollTop(),p=this.$viewport.scrollLeft(),q=0,r=0,s=0,t=0;for(j.length=h.sumWidths=h.sumHeights=h.totalWidth=h.totalHeight=0,h.widestPage.totalActualWidth=h.tallestPage.totalActualHeight=0,b=0,c=this.$pages.length;c>b;++b)g=this.$pages.eq(b),f=g[0],d=i[b],(!d||a)&&(g.css("padding",""),d={index:b,paddingLeft:parseFloat(g.css(n)),paddingRight:parseFloat(g.css(m)),paddingTop:parseFloat(g.css(l)),paddingBottom:parseFloat(g.css(o))}),d.actualWidth||(d.actualWidth=parseFloat(f.getAttribute("data-width"))),d.actualHeight||(d.actualHeight=parseFloat(f.getAttribute("data-height"))),d.totalActualWidth=d.actualWidth+d.paddingLeft+d.paddingRight,d.totalActualHeight=d.actualHeight+d.paddingTop+d.paddingBottom,d.width=f.offsetWidth,d.height=f.offsetHeight,d.x0=f.offsetLeft,d.y0=f.offsetTop,d.x1=d.width+d.x0,d.y1=d.height+d.y0,r&&e(i,j[q])<=d.y0+2&&q++,r=d.y1,j[q]||(j[q]=[]),d.totalActualWidth>h.widestPage.totalActualWidth&&(h.widestPage=d),d.totalActualHeight>h.tallestPage.totalActualHeight&&(h.tallestPage=d),h.sumWidths+=d.width,h.sumHeights+=d.height,d.rowIndex=q,i[b]=d,j[q].push(b),i[s].x0+i[s].width<d.x0+d.width&&(s=b),i[t].y0+i[t].height<d.y0+d.height&&(t=b);h.totalWidth=i[s].x0+i[s].width,h.totalHeight=i[t].y0+i[t].height,h.scrollTop=k,h.scrollLeft=p,this.setCurrentPage(this.calculateCurrentPage())},updateCurrentPage:function(){var a=this.calculateCurrentPage();this.setCurrentPage(a)},handleResize:function(a){var b=this.state.zoomState.zoomMode;this.state.viewportDimensions=a,this.updateZoomLevels(),this.setZoom(b)},handleScroll:function(a){this.state.scrollTop=a.scrollTop,this.state.scrollLeft=a.scrollLeft},handleScrollEnd:function(a){this.$doc.find("."+g).removeClass(g),this.$pages.eq(this.state.currentPage-1).addClass(g),this.updateVisiblePages(!0),this.handleScroll(a)},updateScrollPosition:function(a){var b,c,d=this.state,e=d.zoomState,f=e.zoom/e.prevZoom;b=d.scrollLeft*f,c=d.scrollTop*f,a!==!0&&(c+=d.viewportDimensions.offsetHeight*(f-1)/2,b+=d.viewportDimensions.offsetWidth*(f-1)/2),this.scrollToOffset(b,c)},focus:function(){this.$viewport.focus()},updateLayout:function(){},calculateZoomAutoValue:function(){return 1},calculateNextPage:function(){return 1},calculatePreviousPage:function(){return 1},extend:function(a){return r.extend({},this,a)}}}),c.addComponent("layout-"+c.LAYOUT_HORIZONTAL,["layout-base"],function(a,b){var d=a.getUtility("common"),e=a.getUtility("browser");return b.extend({calculateZoomAutoValue:function(){var a=this.state,b=this.calculateZoomValue(c.ZOOM_FIT_WIDTH),d=this.calculateZoomValue(c.ZOOM_FIT_HEIGHT);return a.widestPage.actualWidth>a.tallestPage.actualHeight?Math.min(b,d):e.mobile?d:Math.min(1,d)},calculateCurrentPage:function(){var a,b,c=this.state,e=c.pages;return a=d.bisectRight(e,c.scrollLeft,"x0")-1,b=d.bisectRight(e,c.scrollLeft+e[a].width/2,"x0")-1,1+b},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},handleResize:function(a){b.handleResize.call(this,a),this.updateCurrentPage()},handleScroll:function(a){b.handleScroll.call(this,a),this.updateCurrentPage()},updateLayout:function(){var a=this.state,b=a.zoomState,c=b.zoom,d=a.sumWidths,e=Math.floor(a.tallestPage.totalActualHeight*c),f=Math.max(d,a.viewportDimensions.clientWidth),g=Math.max(e,a.viewportDimensions.clientHeight);this.$doc.css({height:g,lineHeight:g+"px",width:f})}})}),c.addComponent("layout-"+c.LAYOUT_PRESENTATION_TWO_PAGE,["layout-"+c.LAYOUT_PRESENTATION],function(a,b){var d=a.getUtility("common");return b.extend({init:function(){this.twoPageMode=!0,b.init.call(this)},calculateNextPage:function(){return this.state.currentPage+2},calculatePreviousPage:function(){return this.state.currentPage-2},calculateZoomValue:function(a){var d=b.calculateZoomValue.call(this,a);return a===c.ZOOM_FIT_WIDTH&&(d/=2),d},scrollToPage:function(a){b.scrollToPage.call(this,a-(a+1)%2)},calculateVisibleRange:function(){var a=this.state.currentPage-1,b=a+1;return d.constrainRange(a,b,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()}})}),c.addComponent("layout-"+c.LAYOUT_PRESENTATION,["layout-base"],function(a,b){var d="crocodoc-page-",e=d+"prev",f=d+"next",g=d+"before",h=d+"after",i=d+"before-buffer",j=d+"after-buffer",k="crocodoc-current-page",l="crocodoc-preceding-page",m=[f,h,e,g,i,j].join(" "),n=a.getUtility("common");return b.extend({init:function(){b.init.call(this),this.updatePageMargins(),this.updatePageClasses()},destroy:function(){b.destroy.call(this),this.$pages.css({margin:"",left:""}).removeClass(m)},calculateZoomAutoValue:function(){var a=this.calculateZoomValue(c.ZOOM_FIT_WIDTH),b=this.calculateZoomValue(c.ZOOM_FIT_HEIGHT);return Math.min(a,b)},calculateCurrentPage:function(){return this.state.currentPage},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},calculateVisibleRange:function(){var a=this.state.currentPage-1;return n.constrainRange(a,a,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()},setCurrentPage:function(a){var c,d,e=n.clamp(a-1,0,this.numPages);b.setCurrentPage.call(this,a),this.$doc.find("."+l).removeClass(l),c=this.$doc.find("."+k),d=this.$pages.eq(e),c[0]!==d[0]&&(c.addClass(l).removeClass(k),d.addClass(k)),this.updateVisiblePages(!0),this.updatePageClasses(e)},scrollToPage:function(a){this.setCurrentPage(a)},updateLayout:function(){var a,b,c,d,e,f,g,h=this.state,i=h.zoomState,j=i.zoom,k=this.currentPage||1,l=h.pages[k-1],m=this.twoPageMode?h.pages[k]:l,n=h.viewportDimensions.clientWidth,o=h.viewportDimensions.clientHeight;a=m.actualWidth,b=l.actualWidth+(this.twoPageMode?a:0),c=l.actualHeight,d=Math.floor((b+l.paddingLeft+m.paddingRight)*j),e=Math.floor(l.totalActualHeight*j),f=Math.max(d,n),g=Math.max(e,o),this.$doc.css({width:f,height:g}),this.updatePageMargins(),f>n||g>o?this.$el.addClass("crocodoc-scrollable"):this.$el.removeClass("crocodoc-scrollable")},updatePageMargins:function(){var a,b,c,d,e,f,g,h,i,j=this.state,k=j.viewportDimensions.clientWidth,l=j.viewportDimensions.clientHeight;for(a=0,b=this.$pages.length;b>a;++a)d=this.$pages.eq(a),c=j.pages[a],i=this.twoPageMode?a%2===1?c.paddingRight:c.paddingLeft:c.paddingRight+c.paddingLeft,e=(c.actualWidth+i)*j.zoomState.zoom,f=(c.actualHeight+c.paddingTop+c.paddingBottom)*j.zoomState.zoom,this.twoPageMode?(g=Math.max(0,(k-2*e)/2),a%2===1&&(g+=e)):g=(k-e)/2,h=(l-f)/2,g=Math.max(g,0),h=Math.max(h,0),d.css({marginLeft:g,marginTop:h})},updatePageClasses:function(){var a=this.$pages,b=this.state.currentPage-1,c=b+1,d=b-1,k=20;a.removeClass(m),this.twoPageMode?(c=b+2,d=b-2,a.slice(Math.max(d,0),b).addClass(e),a.slice(c,c+2).addClass(f)):(d>=0&&a.eq(d).addClass(e),c<this.numPages&&a.eq(c).addClass(f)),a.slice(0,b).addClass(g),a.slice(Math.max(0,b-k),b).addClass(i),a.slice(c).addClass(h),a.slice(c,Math.min(this.numPages,c+k)).addClass(j)
}})}),c.addComponent("layout-"+c.LAYOUT_VERTICAL_SINGLE_COLUMN,["layout-"+c.LAYOUT_VERTICAL],function(a,b){return b}),c.addComponent("layout-"+c.LAYOUT_VERTICAL,["layout-base"],function(a,b){var d=a.getUtility("common"),e=a.getUtility("browser");return b.extend({calculateZoomAutoValue:function(){var a=this.state,b=this.calculateZoomValue(c.ZOOM_FIT_WIDTH),d=this.calculateZoomValue(c.ZOOM_FIT_HEIGHT);return a.widestPage.actualWidth>a.tallestPage.actualHeight?Math.min(1,b,d):e.mobile?b:Math.min(1,b)},calculateCurrentPage:function(){var a,b,c,e,f,g=this.state,h=g.pages;return a=d.bisectRight(h,g.scrollTop,"y0")-1,0>a?1:(f=g.scrollTop+h[a].height/2,b=d.bisectRight(h,f,"y0")-1,c=h[b].rowIndex,e=g.rows[c],1+e[0])},calculateNextPage:function(){var a=this.state,b=a.pages[a.currentPage-1],c=b.rowIndex,d=a.rows[c+1];return d&&d[0]+1||a.currentPage},calculatePreviousPage:function(){var a=this.state,b=a.pages[a.currentPage-1],c=b.rowIndex,d=a.rows[c-1];return d&&d[0]+1||a.currentPage},handleResize:function(a){b.handleResize.call(this,a),this.updateCurrentPage()},handleScroll:function(a){b.handleScroll.call(this,a),this.updateCurrentPage()},updateLayout:function(){var a,b,c=this.state,d=c.zoomState.zoom;a=Math.floor(c.widestPage.totalActualWidth*d),b=a<=c.viewportDimensions.clientWidth?"auto":a,this.$doc.css({width:b})}})}),c.addComponent("lazy-loader",function(a){function c(a){a=a||w;var b=A.page-1,c=b-a,d=b+a;return s.constrainRange(c,d,o-1)}function d(){var a;clearTimeout(r),v.length>0?(a=v.shift(),n[a]?u.loadPage(a,function(a){a===!1?d():r=setTimeout(d,B)}):d()):f()}function e(){clearTimeout(r),x=!1,r=setTimeout(d,B)}function f(){clearTimeout(r),x=!0}function g(a){v.push(a),x&&e()}function h(){v.length=0,f()}function i(a,b){var d=c(b);return a>=d.min&&a<=d.max?!0:!1}function j(a){var b=n[a];if(b){if(i(a))return!0;if(l(a))return!0}return!1}function k(a,b){return i(a,b)?!1:l(a)?!1:!0}function l(a){return s.inArray(a+1,A.visiblePages)>-1}function m(a,b){for(var c=s.sign(b-a);a!==b;)u.queuePageToLoad(a),a+=c;u.queuePageToLoad(a)}var n,o,p,q,r,s=a.getUtility("common"),t=a.getUtility("browser"),u={},v=[],w=1,x=!0,y=1,z=!1,A={page:1,visiblePages:[1]},B=t.mobile||t.ielt10?100:50,C=t.mobile||t.ielt10?8:32,D=1e3;return s.extend(u,{messages:["beforezoom","pageavailable","pagefocus","ready","scroll","scrollend","zoom"],onmessage:function(a,b){switch(a){case"beforezoom":this.handleBeforeZoom(b);break;case"pageavailable":this.handlePageAvailable(b);break;case"pagefocus":this.handlePageFocus(b);break;case"ready":this.handleReady();break;case"scroll":this.handleScroll();break;case"scrollend":this.handleScrollEnd();break;case"zoom":this.handleZoom(b)}},init:function(a){n=a,o=n.length,w=Math.min(C,o)},destroy:function(){this.cancelAllLoading()},updateLayoutState:function(a){y=s.sign(a.page-A.page),A=a},loadNecessaryPages:s.debounce(100,function(){this.cancelAllLoading(),this.queuePageToLoad(A.page-1),this.loadVisiblePages(),this.loadPagesInRange(w)}),loadPagesInRange:function(a){var b=A.page-1;a>0&&(a=c(a),y>=0?(m(b+1,a.max),m(b-1,a.min)):(m(b-1,a.min),m(b+1,a.max)))},loadVisiblePages:function(){var a,b;for(a=0,b=A.visiblePages.length;b>a;++a)this.queuePageToLoad(A.visiblePages[a]-1)},queuePageToLoad:function(a){j(a)&&(n[a].preload(),g(a))},cancelAllLoading:function(){clearTimeout(q),clearTimeout(p),h()},loadPage:function(a,c){b.when(n[a]&&n[a].load()).always(c)},unloadPage:function(a){var b=n[a];b&&b.unload()},unloadUnnecessaryPages:function(a){var b,c;for(b=0,c=n.length;c>b;++b)k(b,a)&&this.unloadPage(b)},handleReady:function(){z=!0,this.loadVisiblePages(),q=setTimeout(function(){u.loadNecessaryPages()},D)},handlePageAvailable:function(a){if(z){var b;if(a.all===!0&&(a.upto=o),a.page)this.queuePageToLoad(a.page-1);else if(a.upto)for(b=0;b<a.upto;++b)this.queuePageToLoad(b)}},handlePageFocus:function(a){this.updateLayoutState(a),z&&(this.cancelAllLoading(),p=setTimeout(function(){u.loadNecessaryPages()},200))},handleBeforeZoom:function(a){z&&(this.cancelAllLoading(),this.unloadUnnecessaryPages(2*a.visiblePages.length))},handleZoom:function(a){this.updateLayoutState(a),z&&this.loadNecessaryPages()},handleScroll:function(){this.cancelAllLoading()},handleScrollEnd:function(){z&&(this.loadNecessaryPages(),this.unloadUnnecessaryPages(w))}})}),c.addComponent("page-img",function(a){var c,d,e,f,g=a.getUtility("browser"),h=!1,i=g.mobile;return{init:function(a,c){d=b(a),f=c},destroy:function(){i=!0,this.unload(),d.empty()},prepare:function(){},preload:function(){e||(e=a.get("page-img",f))},load:function(){return this.preload(),e.done(function(a){h||(h=!0,c=b(a).appendTo(d)),c.show()}),e.fail(function(b){h=!1,b&&a.broadcast("asseterror",b)}),e},unload:function(){e&&(e.abort(),e=null),i?(c&&(c.remove(),c=null),h=!1):c&&c.hide()}}}),c.addComponent("page-links",function(a){function c(a){var c=b("<a>").addClass(f),h=a.bbox[0],i=a.bbox[1],j={};if(g.ie&&b("<span>").appendTo(c).on("click",d),c.css({left:h+"pt",top:i+"pt",width:a.bbox[2]-h+"pt",height:a.bbox[3]-i+"pt"}),a.uri){if(!/^http|^mailto/.test(a.uri))return;j.href=encodeURI(a.uri),j.target="_blank"}else a.destination&&(j.href="#page-"+a.destination.pagenum);c.attr(j),c.data("link",a),c.appendTo(e)}function d(c){var d=g.ie?c.target.parentNode:c.target,e=b(d),f=e.data("link");f&&a.broadcast("linkclick",f),c.preventDefault()}var e,f="crocodoc-page-link",g=a.getUtility("browser");return{init:function(a,c){e=b(a),this.createLinks(c),g.ie||e.on("click","."+f,d)},destroy:function(){e.empty().off("click"),e=g=null},createLinks:function(a){var b,d;for(b=0,d=a.length;d>b;++b)c(a[b])}}}),c.addComponent("page-svg",function(c){function d(){switch(H){case s:case y:return b("<iframe>");case x:case t:return b("<object>").attr({type:p,data:"data:"+p+";base64,"+a.btoa(r)});case u:return b("<div>");case v:return b("<object>");case w:case z:return b("<img>")}}function e(){l&&0!==l.length||(E=!1,l=d()),0===l.parent().length&&l.appendTo(m)}function f(){return E||H===v||H===w?b.Deferred().resolve().promise({abort:function(){}}):c.get("page-svg",o)}function g(a){var b=a.querySelectorAll("use");[].forEach.call(b,function(b){var c=b.getAttribute("xlink:href"),d=a.querySelector(c).cloneNode(),e=b.parentNode;d.removeAttribute("id"),d.setAttribute("transform",b.getAttribute("transform")),e.replaceChild(d,b)})}function h(b){var d,e,f,h,j,k=l[0].contentDocument,m=l[0].contentWindow||k&&k.defaultView;switch(H){case s:A.ielt10&&(b=b.replace(/<xhtml:link.*/,"")),h=q+b,A.ielt10?k.body.innerHTML=h:(k.documentElement.innerHTML=h,(A.ios||A.safari)&&A.version<7&&g(k)),f=k.getElementsByTagName("svg")[0];break;case y:k.documentElement.innerHTML=q;var n=k.getElementsByTagName("head")[0]||k.documentElement,r=k.createElement("script"),C="("+i+")()";r.type="text/javascript";try{r.appendChild(document.createTextNode(C))}catch(D){r.text=C}return n.insertBefore(r,n.firstChild),void("complete"===k.readyState?m.loadSVG(b):m.onload=function(){this.loadSVG(b)});case t:d=new B,e=d.parseFromString(b,p),f=k.importNode(e.documentElement,!0),k.documentElement.appendChild(f);break;case x:m.loadSVG(b),f=k.querySelector("svg");break;case u:d=new B,e=d.parseFromString(b,p),f=document.importNode(e.documentElement,!0),l.append(f);break;case v:l.attr({type:p,data:c.getDataProvider("page-svg").getURL(o)}),f=l[0];break;case w:f=l[0],f.src=c.getDataProvider("page-svg").getURL(o);break;case z:f=l[0],j="data:"+p,f.src=!A.ie&&a.btoa?j+";base64,"+a.btoa(b):j+","+encodeURIComponent(b)}f.setAttribute("width","100%"),f.setAttribute("height","100%")}function i(){a.loadSVG=function(b){var c=new a.DOMParser,d=c.parseFromString(b,"image/svg+xml"),e=document.importNode(d.documentElement,!0);e.setAttribute("width","100%"),e.setAttribute("height","100%"),document.body?document.body.appendChild(e):document.documentElement.appendChild(e)}}function j(a){C||D||(!E&&a&&(h(a),E=!0,G||(n.abort(),n=null)),0===l.parent().length&&l.appendTo(m),l.show())}function k(a){c.broadcast("asseterror",a),E=!1,n&&n.abort()}var l,m,n,o,p="image/svg+xml",q="<style>html,body{width:100%;height:100%;margin:0;overflow:hidden;}</style>",r='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"><script><![CDATA[('+i+")()]]></script></svg>",s=1,t=2,u=3,v=4,w=5,x=6,y=7,z=8,A=c.getUtility("browser"),B=a.DOMParser,C=!1,D=!1,E=!1,F=c.getConfig(),G=A.mobile||A.ielt10,H=A.ielt11||A.firefox?z:s;return{init:function(a,b){m=a,o=b,H=F.embedStrategy||H},destroy:function(){C=!0,G=!0,this.unload(),m.empty()},prepare:function(){e()},preload:function(){this.prepare(),n||(n=f())},load:function(){return D=!1,this.preload(),n.done(j).fail(k),n},unload:function(){D=!0,n&&"resolved"!==n.state()&&(n.abort(),n=null),G?(l&&(l.remove(),l=null),E=!1):l&&l.hide()}}}),c.addComponent("page-text",function(a){function c(){return o.enableTextSelection&&!k.ielt9}function d(a){var b,c;!a||n||m||(n=!0,b=document.implementation.createHTMLDocument(""),b.getElementsByTagName("body")[0].innerHTML=a,a=null,c=document.importNode(b.querySelector("."+j),!0),g.attr("class",c.getAttribute("class")),g.html(c.innerHTML),l.fix(g))}function e(b){b&&a.broadcast("asseterror",b)}function f(){return h||(h=c()?a.get("page-text",i):b.Deferred().resolve().promise({abort:function(){}})),h}var g,h,i,j="crocodoc-page-text",k=a.getUtility("browser"),l=a.getUtility("subpx"),m=!1,n=!1,o=a.getConfig();return{init:function(a,b){g=a,i=b},destroy:function(){m=!0,this.unload(),g.empty()},preload:function(){f()},load:function(){return f().done(d).fail(e)},unload:function(){h&&"resolved"!==h.state()&&(h.abort(),h=null)},enable:function(){g.css("display",""),h&&!n&&(h=null)},disable:function(){g.css("display","none")}}}),c.addComponent("page",function(a){var d,e,f,g,h,i,j,k,l="crocodoc-page-",m=l+"loading",n=l+"error",o=l+"text",p=l+"svg",q=l+"links",r=a.getUtility("support"),s=a.getUtility("common"),t=!1;return{messages:["pageavailable","pagefocus","textenabledchange","zoom"],onmessage:function(a,b){switch(a){case"pageavailable":(b.page===i+1||b.upto>i||b.all===!0)&&k===c.PAGE_STATUS_CONVERTING&&(k=c.PAGE_STATUS_NOT_LOADED);break;case"textenabledchange":b.enabled===!0?this.enableTextSelection():this.disableTextSelection();break;case"pagefocus":case"zoom":j=h===b.page||s.inArray(h,b.visiblePages)>-1}},init:function(b,j){var l,m,n;d=b,m=b.find("."+p),l=b.find("."+o),n=b.find("."+q),k=j.status||c.PAGE_STATUS_NOT_LOADED,i=j.index,h=i+1,this.config=j,j.url=j.url||"",e=a.createComponent("page-text"),f=a.createComponent(r.svg?"page-svg":"page-img"),e.init(l,h),f.init(m,h),j.enableLinks&&j.links.length&&(g=a.createComponent("page-links"),g.init(n,j.links))},destroy:function(){this.unload()},preload:function(){f.prepare(),k===c.PAGE_STATUS_NOT_LOADED&&(f.preload(),e.preload())},load:function(){var g=this;return t=!0,k===c.PAGE_STATUS_ERROR?!1:k===c.PAGE_STATUS_CONVERTING?!1:(k!==c.PAGE_STATUS_LOADED&&(k=c.PAGE_STATUS_LOADING),b.when(f.load(),e.load()).done(function(){t?k!==c.PAGE_STATUS_LOADED&&(d.removeClass(m),k=c.PAGE_STATUS_LOADED,a.broadcast("pageload",{page:h})):g.unload()}).fail(function(b){k=c.PAGE_STATUS_ERROR,d.addClass(n),a.broadcast("pagefail",{page:i+1,error:b})}))},unload:function(){t=!1,f.unload(),e.unload(),k===c.PAGE_STATUS_LOADED&&(k=c.PAGE_STATUS_NOT_LOADED,d.addClass(m),d.removeClass(n),a.broadcast("pageunload",{page:h}))},enableTextSelection:function(){e.enable(),j&&e.load()},disableTextSelection:function(){e.disable()}}}),c.addComponent("resizer",function(c){function d(){c.broadcast("resize",{width:j,height:k,clientWidth:h,clientHeight:i,offsetWidth:j,offsetHeight:k})}function e(){m.cancelAnimationFrame(l),f(),l=m.requestAnimationFrame(e,g)}function f(){var b=g.offsetHeight,e=g.offsetWidth;return r&&0===q&&0!==a.innerWidth?(q=a.innerWidth,void c.broadcast("layoutchange")):void(b&&(b!==k||e!==j)&&(k=b,j=e,i=g.clientHeight,h=g.clientWidth,d()))}var g,h,i,j,k,l,m=c.getUtility("support"),n=[""," webkit"," moz"," "].join("fullscreenchange")+"MSFullscreenChange",o=b(a),p=b(document),q=0,r=function(){try{return a.self!==a.top}catch(b){return!0}}();return{messages:["layoutchange"],onmessage:function(){k=null,f()},init:function(c){g=b(c).get(0),g===a?(g=document.documentElement,o.on("resize",f),f()):e(),p.on(n,f)},destroy:function(){p.off(n,f),o.off("resize",f),m.cancelAnimationFrame(l)}}}),c.addComponent("scroller",function(a){function c(){return{scrollTop:j.scrollTop(),scrollLeft:j.scrollLeft()}}function d(){r=!1,w=null,clearTimeout(k),a.broadcast("scrollend",c())}function e(){r||(r=!0,a.broadcast("scrollstart",c())),clearTimeout(k),k=setTimeout(d,q),x()}function f(){s=!0,t=!1,u=!1,e()}function g(){u=!0,e()}function h(){s=!1,t=!0,v=(new Date).getTime(),u&&i()}function i(){return clearTimeout(k),null===w&&(w=(new Date).getTime()),(new Date).getTime()-w>n?void d():(x(),void(k=setTimeout(i,o)))}var j,k,l=a.getUtility("common"),m=a.getUtility("browser"),n=3e3,o=30,p=200,q=m.mobile?500:250,r=!1,s=!1,t=!1,u=!1,v=0,w=null,x=l.throttle(p,function(){a.broadcast("scroll",c())});return{init:function(a){j=b(a),j.on("scroll",e),j.on("touchstart",f),j.on("touchmove",g),j.on("touchend",h)},destroy:function(){clearTimeout(k),j.off("scroll",e),j.off("touchstart",f),j.off("touchmove",g),j.off("touchend",h)}}}),c.addComponent("viewer-base",function(d){function e(){v.attr(E,u.metadata.version||"0.0.0"),ab.mobile&&v.addClass(M),ab.ielt9&&v.addClass(N),bb.svg&&v.addClass(O)}function f(){var a=u.metadata;u.numPages=a.numpages,u.pageStart?u.pageStart<0&&(u.pageStart=a.numpages+u.pageStart):u.pageStart=1,u.pageStart=_.clamp(u.pageStart,1,a.numpages),u.pageEnd?u.pageEnd<0&&(u.pageEnd=a.numpages+u.pageEnd):u.pageEnd=a.numpages,u.pageEnd=_.clamp(u.pageEnd,u.pageStart,a.numpages),u.numPages=u.pageEnd-u.pageStart+1}function g(){v.html(Y),u.useWindowAsViewport?(u.$viewport=b(a),v.addClass(P)):u.$viewport=v.find("."+H),u.$doc=v.find("."+G)}function h(){var a,c,d,e,f,g,h,i,j=_.calculatePtSize(),k=u.metadata.dimensions,l="";for(u.pageScale=$/(k.width*j),d=u.zoomLevels[u.zoomLevels.length-1],e=3/u.pageScale;e>d;)d+=d/2,u.zoomLevels.push(d);for(k.exceptions=k.exceptions||{},a=u.pageStart-1;a<u.pageEnd;a++)c=a+1,c in k.exceptions?(f=k.exceptions[c].width,g=k.exceptions[c].height):(f=k.width,g=k.height),h=f*j,i=g*j,h*=u.pageScale,i*=u.pageScale,l+=_.template(Z,{w:h,h:i});u.$pages=b(l).appendTo(u.$doc)}function i(){var a,b,c=u.plugins||{};for(a in c)b=d.createComponent("plugin-"+a),b&&_.isFn(b.init)&&b.init(u.plugins[a])}function j(){e(),h(),l(),n(),x=d.createComponent("lazy-loader"),x.init(u.pages),z=d.createComponent("scroller"),z.init(u.$viewport),A=d.createComponent("resizer"),A.init(u.$viewport),(!u.enableLinks||ab.ielt9)&&t.disableLinks(),t.setLayout(u.layout),d.broadcast("ready",{page:u.page||1,numPages:u.numPages}),d.ready()}function k(a){return 0===a||u.conversionIsComplete?c.PAGE_STATUS_NOT_LOADED:c.PAGE_STATUS_CONVERTING}function l(){var a,b,c=[],e=u.pageStart-1,f=u.pageEnd,g=m();for(a=e;f>a;a++)b=d.createComponent("page"),b.init(u.$pages.eq(a-e),{index:a,status:k(a),enableLinks:u.enableLinks,links:g[a],pageScale:u.pageScale}),c.push(b);u.pages=c}function m(){var a,b,c,d=u.metadata.links||[],e=[];for(a=0,b=u.metadata.numpages;b>a;++a)e[a]=[];for(a=0,b=d.length;b>a;++a)c=d[a],e[c.pagenum-1].push(c);return e}function n(){b(document).on("mouseup",p)}function o(b){var c=t.fire("linkclick",b);c.isDefaultPrevented()||(b.uri?a.open(b.uri):b.destination&&t.scrollTo(b.destination.pagenum))}function p(){q()}function q(){var a=_.getSelectedNode(),c=b(a).closest("."+Q);v.find("."+L).removeClass(L),a&&v.has(a)&&c.addClass(L)}function r(a){a?B||(v.addClass(J),B=d.createComponent("dragger"),B.init(u.$viewport)):B&&(v.removeClass(J),d.destroyComponent(B),B=null)}function s(){var a;u.queryParams&&(a="string"==typeof u.queryParams?u.queryParams.replace(/^\?/,""):_.param(u.queryParams)),u.queryString=a?"?"+a:""}var t,u,v,w,x,y,z,A,B,C,D="crocodoc-",E="data-svg-version",F=D+"viewer",G=D+"doc",H=D+"viewport",I=D+"viewer-logo",J=D+"draggable",K=D+"dragging",L=D+"text-selected",M=D+"mobile",N=D+"ielt9",O=D+"supports-svg",P=D+"window-as-viewport",Q=D+"page",R=Q+"-inner",S=Q+"-content",T=Q+"-svg",U=Q+"-text",V=Q+"-links",W=Q+"-autoscale",X=Q+"-loading",Y='<div tabindex="-1" class="'+H+'"><div class="'+G+'"></div></div><div class="'+I+'"></div>',Z='<div class="'+Q+" "+X+'" style="width:{{w}}px; height:{{h}}px;" data-width="{{w}}" data-height="{{h}}"><div class="'+R+'"><div class="'+S+'"><div class="'+T+'"></div><div class="'+W+'"><div class="'+U+'"></div><div class="'+V+'"></div></div></div></div></div>',$=1024,_=d.getUtility("common"),ab=d.getUtility("browser"),bb=d.getUtility("support");return{messages:["asseterror","destroy","dragend","dragstart","fail","layoutchange","linkclick","pagefail","pagefocus","pageload","pageunload","ready","resize","scrollstart","scrollend","zoom"],onmessage:function(a,b){switch(a){case"layoutchange":t.updateLayout();break;case"linkclick":o(b);break;case"zoom":b.zoom*=u.pageScale,b.prevZoom*=u.pageScale,u.enableDragging&&r(b.isDraggable),t.fire(a,b);break;case"dragstart":v.hasClass(K)||v.addClass(K),t.fire(a,b);break;case"dragend":v.hasClass(K)&&v.removeClass(K),t.fire(a,b);break;default:t.fire(a,b)}},init:function(){if(u=d.getConfig(),t=u.api,u.namespace=F+"-"+u.id,v=u.$el,v.addClass(F),v.addClass(u.namespace),!u.url)throw new Error("no URL given for viewer assets");/\/$/.test(u.url)||(u.url+="/"),ab.ielt9&&t.disableTextSelection(),u.url=d.getUtility("url").makeAbsolute(u.url),s(),g(),i()},destroy:function(){b(document).off("mouseup",p),v.empty().removeClass(function(a,b){var c=b.match(new RegExp("crocodoc\\S+","g"));return c&&c.join(" ")}),b(w).remove(),C&&C.abort()},setLayout:function(a){var b,c=u.page,e=u.zoom||1;if(y){if(a===u.layout)return y;c=y.state.currentPage,e=y.state.zoomState}if(b=d.createComponent("layout-"+a),!b)throw new Error("Invalid layout "+a);y&&d.destroyComponent(y);var f=u.layout;return u.layout=a,y=b,y.init(),y.setZoom(e.zoomMode||e.zoom||e),y.scrollTo(c),u.currentLayout=y,d.broadcast("layoutchange",{previousLayout:f,layout:a}),y},loadAssets:function(){var a,c,e,g;C||(c=d.get("metadata"),c.then(function(a){u.metadata=a,f()}),ab.ielt9?(w=_.insertCSS(""),u.stylesheet=w.styleSheet,a=b.when("").promise({abort:function(){}})):(a=d.get("stylesheet"),a.then(function(a){w=_.insertCSS(a),u.stylesheet=w.sheet})),u.pageStart&&1!==u.pageStart||(bb.svg?e=d.get("page-svg",1):u.conversionIsComplete&&(e=d.get("page-img",1)),u.enableTextSelection&&(g=d.get("page-text",1))),C=b.when(c,a).fail(function(a){C&&C.abort(),d.ready(),d.broadcast("asseterror",a),d.broadcast("fail",a)}).then(j).promise({abort:function(){C=null,c.abort(),a.abort(),e&&e.abort(),g&&g.abort()}}))}}}),c})}("undefined"!=typeof window?window:this);